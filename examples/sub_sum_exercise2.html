<html>
	<head>
		<title>Example JS Exercise</title>
		<link href="jsassess.css" rel="stylesheet" type="text/css"/>
	</head>
<body>
<h2>Maximum subsum function</h2>
<noscript>Are you kidding? You're trying to learn JavaScript with JavaScript turned off? Go fix it and come back soon!</noscript>
<div>
<p>
First try to solve this exercise and then start reading Programming
Pearls (Jon Bentley, second edition), Chapter 8 from where this
program is taken and where the insights of this simple exercise discussed in details.
</p>

<blockquote>
<p>
The problem arose in one-dimensional pattern recognition [...]
The input is a vector x of n floating-point numbers; the output is the 
maximum sum found in any contiguous subvector of the input. 
For instance, if the input vector contains these ten elements
</p>

<table>
<tr><td>31</td><td>-41</td><td>59</td><td>26</td><td>-53</td><td>58</td><td>97</td><td>-93</td><td>-23</td><td>84</td></tr>
<tr><td></td><td></td><td>&uarr;</td><td></td><td></td><td></td><td>&uarr;</td><td></td><td></td><td></td></tr>
</table>

<p>Then the program return the sum of x[2..6], or 187.</p>
</blockquote>
<p>Try to make your solution efficient and elegant if possible. 
</p>

</div>
<form>
<textarea id="editor2" style="height: 250px; width: 100%;">function subSum(vector) {
 // write your code here
}</textarea>
</form>
<div id="exerciseButtons">
	<a href="#" id="submitButton">Get feedback</a>
</div>
<div id="feedback">
<div id="jslint"></div>
<div id="test"></div>
<div id="jsmeter"></div>
</div>
<div id="iframes"></div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="../javascript/edit_area/edit_area_full.js"></script>
<script type="text/javascript" src="../javascript/jsmeter/json2.js"></script>
<script type="text/javascript">
var exerciseOptions = {};
var jsmeterFilters = { 
	//["Line", "Function", "Statements", "Lines", "Comment Lines", 
	//	 "Comment%", "Branches", "Depth", "Cyclomatic Complexity", 
	//	 "Halstead Volume", "Halstead Potential", "Program Level", "MI"]
	defaultFilter: function(metrics) {
		var html = "<table>";
		for (var index in metrics) {
			html += "<tr>";
			for (var index2 in metrics[index]) {
				html += "<td>" + metrics[index][index2] + "</td>";				
			}
			html += "</tr>";
		}
		html += "</table>";
		return html;
	},
	restrictedDepthFilter: function(metrics) {
		var depth = 0;
		for (var index in metrics) {
			if (index === "0") { continue; }
			depth += metrics[index][7];
		}
		var bgColor = "green", feedback = "Complexity looks not too complex :)";
		if (depth >= 3) { 
			bgColor = "red";
			feedback = "Your algorithm looks quite complex, perhaps O(N<sup>3</sup>)";
		} else if (depth > 1) {
			bgColor = "orange";
			feedback = "Pretty good, perhaps O(N<sup>2</sup>) or O(NlogN)"
		}
		return '<div style="color:' + bgColor + '">' + feedback + '</div>';
	}
};
jQuery().ready(function() {
	editAreaLoader.init({
		id : "editor2",		// textarea id
		syntax: "js",			// syntax to be uses for highgliting
		start_highlight: true		// to display with highlight mode on start-up
	});
	jQuery("#submitButton").click(function(event) {
		event.preventDefault();
		event.stopPropagation();
		if (exerciseOptions.jsmeter) {
			run("jsmeter", exerciseOptions);
		}
		if (exerciseOptions.jslint) {
			run("jslint", exerciseOptions);
		}
		if (exerciseOptions.tests) {
			for (var index in exerciseOptions.tests) {
				runTests(exerciseOptions.tests[index]);
			}
		}
	});
});
if (window.addEventListener) {
	window.addEventListener( "message", handleMessage, false);
}
function handleMessage(msg) {
	data = JSON.parse(msg.data);
	jQuery("#" + data.type + "iframe").remove();
	if (data.type === 'jsmeter') {
		jQuery("#" + data.type).html("<h1>Complexity metrics</h1>" + exerciseOptions.jsmeter(data.results));		
	} else if (data.type === 'jslint'){
		jQuery("#" + data.type).html("<h1>Programming and style errors</h1>" + data.results);
	} else if (data.type === 'test') {
		jQuery("#" + data.type).html("<h1>Functionality</h1>" + data.results);
	}
}
function run(type, exerciseOptions) {
	var jsrunframe = document.createElement("iframe");
	jsrunframe.id = type + "iframe";
	var framesrc = exerciseOptions.commonspath + type + ".html?code=" + encodeURIComponent(editAreaLoader.getValue("editor2")) +
		"&options=" + encodeURIComponent(JSON.stringify(exerciseOptions[type]));
	jsrunframe.src = exerciseOptions.commonspath + type + ".html?code=" + encodeURIComponent(editAreaLoader.getValue("editor2")) +
		"&options=" + encodeURIComponent(JSON.stringify(exerciseOptions[type]));
	jQuery("#iframes").append(jsrunframe);
}
function runTests(testFile, exerciseOptions) {
	var jsrunframe = document.createElement("iframe");
	jsrunframe.id = "testiframe";
	jsrunframe.src = "./" + testFile + "?code=" + encodeURIComponent(editAreaLoader.getValue("editor2"));
	jQuery("#iframes").append(jsrunframe);
}
</script>
<script>
exerciseOptions = {'jsmeter': jsmeterFilters.restrictedDepthFilter, 
  				   'jslint': true,
				   'tests': ['sub_sum_qunit.html'],
				   'commonspath': '../javascript/'};
</script>
</body></html>
